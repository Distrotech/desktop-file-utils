2003-05-29  Havoc Pennington  <hp@redhat.com>

	* src/gen-compat-tree.c (process_one_file): fix build 	

2003-05-28  Havoc Pennington  <hp@redhat.com>

	* src/canonicalize.c (g_canonicalize_file_name): add
	allow_missing_basename argument

	* src/menu-tree-cache.c (init_xdg_paths): hack to pass in 
	the create_chaining_to to desktop_entry_tree_load()

	* src/menu-method.c (menu_method_get_tree): adapt to new API

	* src/menu-process.c (desktop_entry_tree_load): take 
	an argument which is the menu file to chain to 
	in a newly-created menu file
	
	* src/menu-layout.c (menu_cache_get_menu_for_file): 
	same, allow specifying a file to chain to if we 
	create a new menu file

2003-05-21  Havoc Pennington  <hp@redhat.com>

        Enough bugfixes to be able to view a sample menu in nautilus and 
	launch apps.
	
	* src/menu-process.c (tree_node_find_subdir_or_entry): fill in the
	node when we are loading a .desktop file

	* src/menu-method.c (menu_method_get_info): new function
	(do_get_file_info): change so we can stat a directory, 
	doh

	* src/menu-process.c (tree_node_find_subdir_or_entry): handle '/'

2003-05-21  Havoc Pennington  <hp@redhat.com>

	* src/menu-overrides.c: implement directory of .desktop file
	overrides

	* src/menu-layout.c (g_file_save_atomically): export

2003-05-20  Havoc Pennington  <hp@redhat.com>

	* src/menu-method.c: code stuff,
	gnomevfs-ls/gnomevfs-cat/gnomevfs-info are now up and running.

	* src/menu-process.c (tree_node_find_subdir_or_entry): fix

	* src/menu-tree-cache.c (parse_search_path_and_prepend): fix
	(init_xdg_paths): fix

	* src/Makefile.am: fix to link the menu-* sources into the VFS
	module.

2003-05-15  Havoc Pennington  <hp@redhat.com>

	* src/menu-method.c: hacking

	* src/menu-process.c (tree_node_find_subdir): fix so we don't
	ignore trailing junk on paths
	(desktop_entry_tree_resolve_path): new

2003-05-14  Havoc Pennington  <hp@redhat.com>

	* src/menu-tree-cache.c: quick implementation without file change
	monitoring.

2003-05-13  Havoc Pennington  <hp@redhat.com>

	* src/menu-tree-cache.c: new file to store cache of
	DesktopEntryTree

2003-05-12  Havoc Pennington  <hp@redhat.com>

	* src/validate.c: fix a bunch of compiler warnings
	(desktop_file_fixup): add code to fix semicolon termination of
	string lists if necessary.

	* src/desktop_file.c (gnome_desktop_file_merge_string_into_list):
	handle case where existing list is missing ';' at the end; 
	patch from Adrian Reber

2003-05-12  Havoc Pennington  <hp@redhat.com>

	* autogen.sh (ACLOCAL): automake, aclocal 1.7

	* configure.in: check for optional gnome-vfs, not required 
	of course, just a hack to share some menu code for now.

	* src/menu-method.c, src/Makefile.am: gnome-vfs boilerplate, 
	doesn't yet do anything.

2003-05-10  Havoc Pennington  <hp@pobox.com>

	* src/menu-layout.c (menu_node_append_to_string): implement
	serialization of the "DOM tree" of menu nodes so that we can 
	resave after editing.
	(menu_node_append_child): fix this, it was messing up order 
	of nodes
	(menu_cache_sync_for_file): implement doing the standard
	write-to-tmp-and-rename hoop-jumping.

2003-05-09  Havoc Pennington  <hp@redhat.com>

	* src/menu-entries.c: use a quark scheme for entry->categories
	to save time/memory

	* src/desktop_file.c (parse_key_value): fix a memory leak

2003-05-09  Havoc Pennington  <hp@redhat.com>

	* src/menu-process.c: refactor this to use MenuCache and
	EntryCache and as a result make more sense.

	* src/menu-layout.c: add MenuCache object; don't track
	is_file_root; don't try to autodrop cache when a menu 
	node is unref'd (didn't work anyway).

	* src/menu-entries.c: invent an EntryCache object to get rid of
	global variables
	
2003-05-09  Havoc Pennington  <hp@pobox.com>

	* src/desktop_file.c: make @ a valid byte in locale names, patch
	from Richi Plana

2003-05-08  Havoc Pennington  <hp@redhat.com>

	* src/menu-process.c (fill_tree_node_from_menu_node): sort entries
	by basename

2003-05-08  Havoc Pennington  <hp@redhat.com>

	* src/menu-entries.c (entry_directory_list_add): fix list
	manipulation screwup that caused obscure memory error
	(find_value): fix bug that made it not work, and avoid extra
	strlen calls

	* src/menu-layout.h: add macros to disable verbose mode

2003-05-06  Havoc Pennington  <hp@redhat.com>

	* src/menu-process.c (foreach_print): add ability to print in the
	format of test suite expected results file

2003-05-05  Havoc Pennington  <hp@redhat.com>

	* src/menu-process.c (tree_node_free_if_broken): allow nodes with
	NULL dir_entry, the menu spec allows that.
	(foreach_dir, foreach_print): assorted fixes, can now print a
	trivial two-item menu.

2003-05-02  Havoc Pennington  <hp@redhat.com>

	* src/menu-layout.c (menu_node_menu_ensure_entry_lists): create
	the node->app_dirs node->dir_dirs objects and account for
	MENU_NODE_ROOT node type

2003-05-02  Havoc Pennington  <hp@redhat.com>

	* src/menu-process.c: use basedir stuff stored on root node 
	instead of dealing with it in this file

	* src/menu-parser.c (menu_load): set basedir

	* src/menu-layout.c (menu_node_copy_one): copy fields in MenuNode
	"subclasses"
	(menu_node_get_basedir): new
	(menu_node_get_content_as_path): new

	* configure.in: add more compiler warnings, and --enable-tests

	* src/menu-layout.c (dfu_test_menu_nodes): start setting up unit
	test stuff

2003-05-01  Havoc Pennington  <hp@pobox.com>

	* src/menu-process.c (desktop_entry_tree_print): implement
	(desktop_entry_tree_foreach): implement

	* src/menu-entries.c (entry_set_new): fix to init to all bits zero

2003-05-01  Havoc Pennington  <hp@redhat.com>

	* src/validate.c: change to only warn about invalid keys, don't
	die
	(enum_keys): remove warning about Icon field with no .png extension	
	(desktop_file_validate): fix to reset fatal_error_occurred on each
	call

	* src/gen-compat-tree.c: hook up the new menu code, so we can
	start debugging

	* src/validate.c: allow GenericName, StartupNotify, StartupWMClass

	* src/menu-parser.c: got it compiling, most code should be there,
	untested

2003-04-30  Havoc Pennington  <hp@redhat.com>

	* src/menu-parser.c: more random hacking, syncing between computers

2003-04-30  Havoc Pennington  <hp@pobox.com>

	* src/menu-parser.c: skeletal noncompiling base file for menu xml
	parser thing

2003-04-11  Havoc Pennington  <hp@redhat.com>

	* src/validate.c (required_keys): don't stop checking as soon as
	we see an Encoding field. Fix from Ville Skytta
	<ville.skytta@iki.fi>

2002-12-21  Havoc Pennington  <hp@pobox.com>

	* test/run-test.c (main): allow specifying expected name of
	directory nodes, and allow quoting names and entry filenames so we
	can test for handling of whitespace etc.

2002-12-15  Havoc Pennington  <hp@pobox.com>

	* src/vfolder-query.c (my_str_has_suffix): rename since glib 2.2
	now has the symbol

	* src/menu-process.c (tree_node_find_subdir): fix compilation

	* test/run-test.c (main): add a start on a test program, which
	takes a file describing the menu file to load and the expected
	results of parsing that menu file, and checks whether the right
	results are generated.

2002-11-21  Havoc Pennington  <hp@redhat.com>

	* src/menu-entries.c (cached_dir_find_entry): fix a bug
	(find_subdir in iter not dir)

	* src/menu-process.c (fill_tree_node_from_menu_node): fill in a
	name for each TreeNode

2002-08-06  Havoc Pennington  <hp@redhat.com>

	* src/vfolder-query.c (symlink_recurse_nodes): add another
	unlink() for .directory files

2002-08-06  Havoc Pennington  <hp@redhat.com>

	* src/vfolder-query.c (symlink_recurse_nodes): unlink symlink
	before trying to create it again, to avoid errors and be sure 
	we replace the old link.

2002-08-04  Havoc Pennington  <hp@redhat.com>

	* src/install.c (main): create target directory if it doesn't 
	exist.

	* configure.in: 0.3

2002-08-01  Havoc Pennington  <hp@redhat.com>

	* src/vfolder-query.c (add_or_free_desktop_file): when complaining
	about a duplicate, say where the other one is.
	(load_tree): only read DATADIR/applications if the menu file
	didn't specify any directories.

2002-07-24  Havoc Pennington  <hp@redhat.com>

	* src/vfolder-query.c (add_or_free_desktop_file): actually 
	get rid of desktop files that should not be shown following
	OnlyShowIn

2002-07-22  Havoc Pennington  <hp@redhat.com>

	* src/gen-compat-tree.c: add --print-available option

	* src/vfolder-query.c: add function to print out all the 
	desktop files that would be used by a menu file

2002-07-09  Havoc Pennington  <hp@redhat.com>

	* src/validate.c (desktop_file_fixup): fix up "KDE Desktop Entry"

	* src/desktop_file.c (gnome_desktop_file_rename_section): new
	function
	(gnome_desktop_file_has_section): new function

2002-07-09  Havoc Pennington  <hp@redhat.com>

	* src/desktop_file.c (gnome_desktop_file_unset_internal): fix a
	memmove to use bytes instead of number of lines, fixes a crash

2002-06-21  Havoc Pennington  <hp@redhat.com>

	* src/validate.c: validate that KDE/GNOME are spelled all-caps in 
	OnlyShowIn

	* src/install.c: add a --remove-key option to remove bogus keys

	* src/validate.c (validate_strings): check that string list keys
	end in a semicolon

2002-06-21  Havoc Pennington  <hp@redhat.com>

	* src/install.c (process_one_file): implement
	--copy-name-to-generic-name, --copy-generic-name-to-name

	* src/desktop_file.c (gnome_desktop_file_copy_key): new function
	(gnome_desktop_file_unset): new

2002-06-16  Havoc Pennington  <hp@pobox.com>

	* src/install.c: fix delete_original flag so it actually gets
	filled in and works

2002-06-05  Havoc Pennington  <hp@redhat.com>

	* configure.in: 0.2 version

	* src/Makefile.am (desktop_menu_tool_SOURCES): rename
	desktop-menu-gen-compat-dir to desktop-menu-tool

2002-05-25  Havoc Pennington  <hp@pobox.com>

	* src/vfolder-query.c (add_or_free_desktop_file): add OnlyShowIn
	support.

2002-05-25  Havoc Pennington  <hp@pobox.com>

	* src/vfolder-query.c (desktop_file_tree_write_symlink_dir): 
	Add the create-a-dir-of-symlinks support.

	* src/desktop_file.c (gnome_desktop_file_merge_string_into_list):
	fix bug when adding the first string in the list.

	* src/vfolder-query.c: handle OnlyUnallocated correctly

2002-05-25  Havoc Pennington  <hp@pobox.com>

	* src/vfolder-query.c, src/vfolder-parser.c: implement more query
	stuff

2002-05-25  Havoc Pennington  <hp@pobox.com>

	* src/validate.c (desktop_file_fixup): move here from install.c

	* src/gen-compat-tree.c (main): initial test version, 
	doesn't work yet

	* src/desktop_file.c (gnome_desktop_file_save): do an atomic save
	via rename() for safety

2002-05-06  Havoc Pennington  <hp@redhat.com>

	* Initial module creation

